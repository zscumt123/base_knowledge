# 浏览器知识汇总

## 浏览器进程

### 1. 单进程浏览器的问题

- 不稳定，出错会导致浏览器崩溃
- 不流畅，脚本或者插件会使得浏览器变卡顿,内存泄露
- 不安全，插件可以获取操作系统资源，脚本可以利用浏览器漏洞获取系统权限

### 2. 多进程浏览器

- 浏览器进程、渲染进程、插件进程、网络进程、GPU 进程、进程间相互隔离
- 页面或者插件崩溃时，影响的只是当前页面，不会影响浏览器或者其他页面
- 即使 js 阻塞了渲染进程，影响的也只是当前页面，关闭一个页面时候，整个渲染
  进程被关闭，该进程所占用的内存被回收，不会造成内存泄露
- 插件进程和渲染进程运行在沙箱中的，恶意程序无法突破沙箱获取到系统权限

#### 2-1.浏览器的进程

- 浏览器进程：负责界面显示，用户交互，子进程管理，提供存储等功能
- 渲染进程： 将 html，css，js 转化为网页，默认情况下，chrome 会为每个 Tab
  标签创建一个渲染进程，渲染进程运行在沙箱模式下
- GPU 进程： UI 界面采用 GPU 绘制
- 网络进程： 负责页面网络资源的加载
- 插件进程： 主要负责插件的运行，保证插件崩溃不会对页面造成影响

#### 2-2.多进程浏览器的问题

- 更高的资源占用
- 更复杂的体系架构

#### 2-3. 未来面向服务的架构（SOA）

- 各个模块被做成独立的服务，每个服务在独立的进程中运行，访问服务
  必须使用定义好的接口，通过 IPC 通信，构建一个更内聚，松耦合，易于维护和扩展
  的系统

### 3. 在浏览器里面，从输入 url 到页面展示，经历了什么

- 浏览器会判断输入的关键字是搜索内容，还是 URL，如果是搜索内容，会使用
  默认的搜索引擎，来合成新的带关键字的 URL，如果是 URL，浏览器准备新页面
  执行当前页面的 beforeunload 事件，标签页面上的图标变成加载状态
- 页面请求资源，浏览器进程会通过 IPC 通信把 URL 发送网络进程，网络进程接收
  到 URL，先查找本地缓存是否缓存了资源，如果有，直接返回资源给浏览器进程
  如果没有，直接进入网络请求流程，DNS 解析，获取到资源服务器的 IP 地址，
  建立 TCP 连接，如果是 https，需要建立 TLS 连接，建立连接后，构建请求行，请求头等
  信息，向服务器发送请求，服务器接收到请求后，将资源发送给网络进程
- 网络进程解析相应头，如果是重定向，重新发起 http 请求，接下来根据 content-type
  判断资源类型，如果是 text/html,就准备渲染进程
- 提交文档，网络进程将 http 响应头数据转发给浏览器进程，浏览器进程通知渲染进程，渲染
  进程和网络进程建立管道连接，数据交给渲染进程。渲染进程最后向浏览器进程发送确认提交
  浏览器进程更新界面状态
- 渲染阶段
  1. 渲染进程将 html 转化为 dom 树
  2. 渲染引擎将样式表转化为浏览器可以理解的 styleSheets,计算 dom 节点样式
  3. 创建布局树，计算元素布局信息
  4. 对布局树进行分层，形成分层树
  5. 为每个图层生成绘制列表， 提交给合成线程
  6. 合成线程将图层转化为图块，在光栅化线程池中经过 GPU 将图块转为位图
  7. 合成线程发送绘制图块命令到浏览器进程
  8. 浏览器进程生成页面，显示

## javscript 执行

### 1.执行上下文

- 执行上下文是执行一段代码的运行环境，执行上下文存在一个变量环境对象
- 执行一个函数时候，会创建函数的执行上下文，函数执行结束，会销毁执行上下文，多个函数执行时候，用栈来管理，调用栈
- 执行上下文， 变量环境和词法环境

### 2.作用域

- 作用域指在程序中定义变量的区域，该位置决定了变量的生命周期。作用域就是变量或者函数的可访问范围，作用域控制着变量和函数的可见性和生命周期
- 词法作用域就是指作用域是由代码中函数声明的位置来决定的，所以词法作用域是静态的作用域，通过它就能够预测代码在执行过程中如何查找标识符
- 闭包 根据词法作用域的规则，内部函数总是可以访问其外部函数中声明的变量，当通过调用一个外部函数返回一个内部函数后，即使该外部函数已经执行结束了，但是内部函数引用外部函数的变量依然保存在内存中，我们就把这些变量的集合称为闭包。
